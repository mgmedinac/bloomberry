{% extends "base.html" %}
{% load static i18n %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/products.css' %}">
<link rel="stylesheet" href="{% static 'css/product_detail.css' %}">
{% endblock %}

{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<div class="bb-main">
  <div class="bb-product-detail">
    
    <!-- Imagen -->
    <div class="bb-product-image">
      {% if product.image %}
        <img src="{{ product.image.url }}" alt="{{ product.name }}">
      {% else %}
        <img src="{% static 'img/no-image.png' %}" alt="{% trans 'Sin imagen' %}">
      {% endif %}
    </div>

    <!-- Info del producto -->
    <div class="bb-product-info">
      <h1>{{ product.name }}</h1>
      <p class="description">{{ product.description }}</p>
      <p class="price">${{ product.price|floatformat:0 }}</p>

      <div class="bb-actions">
        <!-- Bot칩n a침adir al carrito -->
        <form method="post" action="{% url 'orders:add_to_cart' product.id %}">
          {% csrf_token %}
          <button type="submit" class="bb-btn primary">
            {% trans "A침adir al carrito" %}
          </button>
        </form>

        <!-- Bot칩n wishlist -->
        <form method="post" action="{% url 'products:add_to_wishlist' product.id %}" style="display:inline;">
          {% csrf_token %}
          <input type="hidden" name="wishlist_name" value="Favoritos">
          <button type="submit" class="bb-btn secondary">
            {% if in_wishlist %}
              {% trans "En tus favoritos" %}
            {% else %}
              {% trans "Agregar a favoritos" %}
            {% endif %}
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Mensajes de feedback -->
  {% if messages %}
    <ul class="messages">
      {% for message in messages %}
        <li class="{{ message.tags }}">{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}

  <!-- Rese침as -->
  <section class="bb-reviews">
    <h2>
      {% trans "Rese침as" %} ({{ product.quantity_of_reviews }})
    </h2>

    {% if reviews %}
      {% for review in reviews %}
        <div class="bb-review">
          <div class="bb-review-header">
            <strong>{{ review.user.username }}</strong>
            <div class="bb-rating">
              {% for i in "12345" %}
                {% if forloop.counter <= review.rating %}
                  游꺚
                {% endif %}
              {% endfor %}
            </div>
          </div>
          <p>{{ review.comment|linebreaks }}</p>
          <small>{{ review.created_at|date:"SHORT_DATETIME_FORMAT" }}</small>
        </div>
      {% endfor %}
    {% else %}
      <p>{% trans "A칰n no hay rese침as para este producto." %}</p>
    {% endif %}
  </section>

  <!-- Formulario para dejar rese침a -->
  <section class="bb-leave-review">
    <h3>{% trans "Deja tu rese침a" %}</h3>

    {% if user.is_authenticated %}
      <form method="post" action="{% url 'products:add_review' product.id %}">
        {% csrf_token %}
        {{ review_form.non_field_errors }}

        <!-- Selector de calificaci칩n -->
        <div class="form-row bb-rating-input">
          <label>{% trans "Tu calificaci칩n" %}</label>
          <div class="bb-flower-select">
            {% for i in "54321" %}
              <input type="radio" id="rating{{ i }}" name="rating" value="{{ i }}">
              <label for="rating{{ i }}" class="bb-flower-label">游꺚</label>
            {% endfor %}
          </div>
        </div>

        <!-- Comentario -->
        <div class="form-row">
          <label for="{{ review_form.comment.id_for_label }}">{{ review_form.comment.label }}</label>
          {{ review_form.comment }}
        </div>

        <!-- Bot칩n enviar -->
        <button type="submit" class="bb-btn primary">
          {% trans "Enviar rese침a" %}
        </button>
      </form>
    {% else %}
      <p>
        {% trans "Debes" %}
        <a href="{% url 'login' %}?next={{ request.path }}">
          {% trans "iniciar sesi칩n" %}
        </a>
        {% trans "para dejar una rese침a." %}
      </p>
    {% endif %}
  </section>
</div>
{% endblock %}
